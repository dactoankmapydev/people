<!DOCTYPE html>
<html lang="vi">
<head>
        <meta charset="utf-8" />
        <title>In ra màn hình số 1 - ngôn ngữ nào nhẹ nhất?</title>
        <link rel="stylesheet" href="http://pp.pymi.vn/theme/css/main.css" />
        <link href="http://pp.pymi.vn/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="The PyMiers Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://pp.pymi.vn/">The PyMiers </a></h1>
                <nav><ul>
                    <li><a href="http://pp.pymi.vn/pages/about.html">About</a></li>
                    <li><a href="http://pp.pymi.vn/pages/add.html">Tạo bài viết</a></li>
                    <li class="active"><a href="http://pp.pymi.vn/category/trang-chu.html">Trang chủ</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="http://pp.pymi.vn/dynamic.html" rel="bookmark"
           title="Permalink to In ra màn hình số 1 - ngôn ngữ nào nhẹ nhất?">In ra màn hình số 1 - ngôn ngữ nào nhẹ nhất?</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-05-27T00:00:00+07:00">
                Published: Sun 27 May 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="http://pp.pymi.vn/author/hvnsweeting.html">hvnsweeting</a>
        </address>
<p>In <a href="http://pp.pymi.vn/category/trang-chu.html">Trang chủ</a>.</p>
<p>tags: <a href="http://pp.pymi.vn/tag/python.html">python</a> <a href="http://pp.pymi.vn/tag/tip.html">tip</a> </p>
</footer><!-- /.post-info -->      <p>Nếu chỉ cần in ra mà hình số 1, ngôn ngữ lập trình nào sẽ chạy tốn ít RAM nhất?</p>
<p>Thí nghiệm sau sẽ cho ta thấy các chương trình cần bao nhiêu RAM để chạy và in
ra số 1, kết thúc dòng bằng một dấu xuống dòng (newline <code>\n</code>).</p>
<p>Ta dùng chương trình <code>/usr/bin/time</code> để có cả thông số về RAM (<code>RSS</code>) thay vì chỉ gõ time - lệnh builtin của bash.</p>
<h2>bash4.3</h2>
<div class="highlight"><pre><span></span>$ /usr/bin/time bash -c <span class="s1">&#39;echo 1&#39;</span>

<span class="m">1</span>

<span class="m">0</span>.00user <span class="m">0</span>.00system <span class="m">0</span>:00.00elapsed <span class="m">100</span>%CPU <span class="o">(</span>0avgtext+0avgdata 3064maxresident<span class="o">)</span>k

0inputs+0outputs <span class="o">(</span>0major+136minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<h2>dash</h2>
<div class="highlight"><pre><span></span>$ /usr/bin/time /bin/dash -c <span class="s1">&#39;echo 1&#39;</span>
<span class="m">1</span>
<span class="m">0</span>.00user <span class="m">0</span>.00system <span class="m">0</span>:00.00elapsed ?%CPU <span class="o">(</span>0avgtext+0avgdata 1492maxresident<span class="o">)</span>k
0inputs+0outputs <span class="o">(</span>0major+67minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<h2>mawk</h2>
<div class="highlight"><pre><span></span>$ /usr/bin/time mawk <span class="s1">&#39;BEGIN {print 1}&#39;</span>

<span class="m">1</span>

<span class="m">0</span>.00user <span class="m">0</span>.00system <span class="m">0</span>:00.00elapsed <span class="m">100</span>%CPU <span class="o">(</span>0avgtext+0avgdata 1932maxresident<span class="o">)</span>k

0inputs+0outputs <span class="o">(</span>0major+86minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<h2>gawk 4.1.3</h2>
<div class="highlight"><pre><span></span>$ /usr/bin/time gawk <span class="s1">&#39;BEGIN {print 1}&#39;</span>

<span class="m">1</span>

<span class="m">0</span>.00user <span class="m">0</span>.00system <span class="m">0</span>:00.00elapsed <span class="m">42</span>%CPU <span class="o">(</span>0avgtext+0avgdata 3632maxresident<span class="o">)</span>k

552inputs+0outputs <span class="o">(</span>2major+173minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<h2>Python3.5.2</h2>
<div class="highlight"><pre><span></span>$ /usr/bin/time python3 -c <span class="s1">&#39;print(1)&#39;</span>

<span class="m">1</span>

<span class="m">0</span>.03user <span class="m">0</span>.01system <span class="m">0</span>:00.05elapsed <span class="m">98</span>%CPU <span class="o">(</span>0avgtext+0avgdata 9292maxresident<span class="o">)</span>k

0inputs+0outputs <span class="o">(</span>0major+1100minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<h2>Python2.7.12</h2>
<div class="highlight"><pre><span></span>$ /usr/bin/time python2 -c <span class="s1">&#39;print(1)&#39;</span>

<span class="m">1</span>

<span class="m">0</span>.01user <span class="m">0</span>.00system <span class="m">0</span>:00.01elapsed <span class="m">94</span>%CPU <span class="o">(</span>0avgtext+0avgdata 6640maxresident<span class="o">)</span>k

0inputs+0outputs <span class="o">(</span>0major+819minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<h2>Ruby 2.3.1</h2>
<div class="highlight"><pre><span></span>$ /usr/bin/time ruby -e <span class="s1">&#39;puts 1&#39;</span>
<span class="m">1</span>
<span class="m">0</span>.03user <span class="m">0</span>.01system <span class="m">0</span>:00.04elapsed <span class="m">100</span>%CPU <span class="o">(</span>0avgtext+0avgdata 10336maxresident<span class="o">)</span>k
0inputs+0outputs <span class="o">(</span>0major+1595minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<h2>Perl v5.22.1</h2>
<div class="highlight"><pre><span></span>$ /usr/bin/time perl -e <span class="s1">&#39;print &quot;1\n&quot;&#39;</span>

<span class="m">1</span>

<span class="m">0</span>.00user <span class="m">0</span>.00system <span class="m">0</span>:00.00elapsed <span class="m">100</span>%CPU <span class="o">(</span>0avgtext+0avgdata 4144maxresident<span class="o">)</span>k

0inputs+0outputs <span class="o">(</span>0major+176minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<h2>NodeJS 6.11.2</h2>
<div class="highlight"><pre><span></span>$ /usr/bin/time node -p <span class="s1">&#39;1&#39;</span>

<span class="m">1</span>

<span class="m">0</span>.09user <span class="m">0</span>.00system <span class="m">0</span>:00.10elapsed <span class="m">100</span>%CPU <span class="o">(</span>0avgtext+0avgdata 24080maxresident<span class="o">)</span>k

0inputs+0outputs <span class="o">(</span>0major+2920minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<h2>Elixir 1.6.3</h2>
<div class="highlight"><pre><span></span>$ /usr/bin/time elixir -e <span class="s1">&#39;IO.puts 1&#39;</span>

<span class="m">1</span>

<span class="m">0</span>.17user <span class="m">0</span>.04system <span class="m">0</span>:00.16elapsed <span class="m">137</span>%CPU <span class="o">(</span>0avgtext+0avgdata 29268maxresident<span class="o">)</span>k

16inputs+0outputs <span class="o">(</span>1major+7837minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<h2>Guile 2.0.11</h2>
<div class="highlight"><pre><span></span>$ /usr/bin/time guile -c <span class="s1">&#39;(display 1) (newline)&#39;</span>

<span class="m">1</span>

<span class="m">0</span>.02user <span class="m">0</span>.00system <span class="m">0</span>:00.01elapsed <span class="m">115</span>%CPU <span class="o">(</span>0avgtext+0avgdata 7720maxresident<span class="o">)</span>k

0inputs+0outputs <span class="o">(</span>0major+976minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<h2>printf 8.25 - chương trình viết bằng C</h2>
<div class="highlight"><pre><span></span>$ /usr/bin/time <span class="nb">printf</span> <span class="s1">&#39;1&#39;</span>

<span class="m">10</span>.00user <span class="m">0</span>.00system <span class="m">0</span>:00.00elapsed <span class="m">100</span>%CPU <span class="o">(</span>0avgtext+0avgdata 1844maxresident<span class="o">)</span>k

0inputs+0outputs <span class="o">(</span>0major+72minor<span class="o">)</span>pagefaults 0swaps
</pre></div>


<h2>Làm lại toàn bộ bằng Python</h2>
<p>Tạo một dictionary, chứa các tên ngôn ngữ - kèm với câu lệnh sẽ dùng để thử nghiệm</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shlex</span>
<span class="kn">import</span> <span class="nn">subprocess</span>


<span class="n">programs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;bash&#39;</span><span class="p">:</span> <span class="s1">&#39;bash -c &quot;echo 1&quot;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dash&#39;</span><span class="p">:</span> <span class="s1">&#39;dash -c &quot;echo 1&quot;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mawk&#39;</span><span class="p">:</span> <span class="s2">&quot;mawk &#39;BEGIN {print 1}&#39;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;gawk&#39;</span><span class="p">:</span> <span class="s2">&quot;gawk &#39;BEGIN {print 1}&#39;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;python2.7&#39;</span><span class="p">:</span> <span class="s1">&#39;python2 -c &quot;print(1)&quot;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;python3.5&#39;</span><span class="p">:</span> <span class="s1">&#39;python3 -c &quot;print(1)&quot;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ruby2.3&#39;</span><span class="p">:</span> <span class="s1">&#39;ruby -e &quot;puts 1&quot;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;node6&#39;</span><span class="p">:</span> <span class="s1">&#39;node -p 1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;perl5&#39;</span><span class="p">:</span> <span class="s2">&quot;perl -e </span><span class="se">\&quot;</span><span class="s2">print &#39;1</span><span class="se">\n</span><span class="s2">&#39;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;elixir&#39;</span><span class="p">:</span> <span class="s1">&#39;elixir -e &quot;IO.puts 1&quot;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;guile&#39;</span><span class="p">:</span> <span class="s1">&#39;guile -c &quot;(display 1) (newline)&quot;&#39;</span><span class="p">,</span>
    <span class="s1">&#39;printf&#39;</span><span class="p">:</span> <span class="s1">&#39;printf &quot;1</span><span class="se">\n</span><span class="s1">&quot;&#39;</span>
<span class="p">}</span>


<span class="kn">import</span> <span class="nn">re</span>

<span class="k">def</span> <span class="nf">get_rss_from_stderr</span><span class="p">(</span><span class="n">stderr</span><span class="p">):</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(?P&lt;rss&gt;\d+)maxresident&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;rss&#39;</span><span class="p">))</span>


<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">languages</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rsses</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">language</span><span class="p">,</span> <span class="n">cmd</span> <span class="ow">in</span> <span class="n">programs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/usr/bin/time&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;1</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">rss</span> <span class="o">=</span> <span class="n">get_rss_from_stderr</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">language</span><span class="p">,</span> <span class="n">rss</span><span class="p">)</span>
    <span class="n">languages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
    <span class="n">rsses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rss</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">languages</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">rsses</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RSS&#39;</span><span class="p">])</span>

<span class="n">df_sorted_rss</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;RSS&#39;</span><span class="p">)</span>

<span class="c1"># run in Jupyter</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;fivethirtyeight&#39;</span><span class="p">)</span>

<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">df_sorted_rss</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;RSS size in byte when print 1&#39;</span><span class="p">);</span>
</pre></div>


<p><img alt="Dynamic typing languages" src="http://pp.pymi.vn/images/dynamic.png" /></p>
<h2>Kết luận</h2>
<p>Khoan vội kết luận rằng cả thế giới nên chuyển hết về dùng dash cho đỡ tốn RAM hay xa lánh Elixir vì nó chạy tới 30 MB RAM để in số 1 ra màn hình.</p>
<p>Sử dụng đúng công cụ, cho đúng vấn đề thích hợp mới là điều quan trọng.</p>
<ul>
<li>dash được viết ra để dùng làm <code>shell (sh)</code> cho Ubuntu, nó cần nhẹ, dù trả giá bằng việc không nhiều tính năng, và chỉ là một shell scripting language</li>
<li><a href="http://www.familug.org/search/label/bash">bash</a> là shell được dùng phổ biến nhất thế giới</li>
<li>awk là ngôn ngữ lập trình đã gắn liền với lịch sử của thế giới UNIX, rất tiện để tính toán dữ liệu cột / hàng. Với AWK cùng các CLI tool truyền thống, người ta có thể <a href="https://adamdrake.com/command-line-tools-can-be-235x-faster-than-your-hadoop-cluster.html">giải quyết bài toán "big data" nhanh gấp 200 lần dùng Hadoop (EMR)</a></li>
<li>mawk nhanh hơn gawk</li>
<li>perl5 luôn có chỗ đứng của nó, nó vẫn ở trên máy Ubuntu dù chưa bao giờ mình chủ ý cài</li>
<li><a href="http://www.familug.org/search/label/guile">guile</a> là extension language chính thức được lựa chọn bởi GNU, nó chính là ngôn ngữ scheme được mang vào ứng dụng thực tế</li>
<li><a href="http://pymi.vn/">Python</a> - ngôn ngữ dễ đọc, phổ biến nhất thế giới, đã đẩy ngành tính toán khoa học từ bộ môn trong phòng thí nghiệm trở thành ngành hot nhất trái đất. PS: Python khi bật lên đã dùng ~ 8MB RAM.</li>
<li>Ruby còn dùng nhiều RAM hơn nữa, dù về mặt tính năng thường được so ngang với Python, nhưng mặt ứng dụng vào khoa học thì là vực so với trời Python.</li>
<li>NodeJS là một JavaScript engine chuyển biến cả ngành web, cũng chưa rõ sao nó ngốn gần 25MB để bật lên, có khi đó vốn là bản chất của JavaScript.</li>
<li><a href="http://elixir.pymi.vn/">Elixir</a> không chỉ bật lên một interpreter như bash, mà đó là cả hệ thống phân tán - chạy máy ảo BEAM của Erlang, nên con số 30MB thậm chí còn là hơi ... ít.</li>
</ul>
<p>Bài này không xét các ngôn ngữ mà phải viết thành file, compile mới chạy, vì tác giả quá lười.</p>
<p>PS: học hết đống trên ở <a href="http://www.familug.org/2016/12/free-ebook.html">đây</a></p>
<p>Hết.</p>
<p>HVN at https://pymi.vn and https://www.familug.org</p>
    </div><!-- /.entry-content -->
    <div class="comments">
      <h2>Comments !</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        var disqus_shortname = 'pymier';
        var disqus_identifier = 'dynamic.html';
        var disqus_url = 'http://pp.pymi.vn/dynamic.html';
        (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//pymier.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the comments.</noscript>
    </div>

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="https://pymi.vn/">PyMi homepage</a></li>
                            <li><a href="http://www.familug.org/">FAMILUG.org</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="http://pp.pymi.vn/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://www.facebook.com/pyfml/">Facebook</a></li>
                            <li><a href="https://github.com/pymivn/">GitHub</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

<script type="text/javascript">
    var disqus_shortname = 'pymier';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>